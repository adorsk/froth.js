CSSOM = exports;
CSSOM.CSSStyleDeclaration=function CSSStyleDeclaration(){this.length=0,this.parentRule=null,this._importants={}},CSSOM.CSSStyleDeclaration.prototype={constructor:CSSOM.CSSStyleDeclaration,getPropertyValue:function(e){return this[e]||""},setProperty:function(e,t,n){if(this[e]){var r=Array.prototype.indexOf.call(this,e);r<0&&(this[this.length]=e,this.length++)}else this[this.length]=e,this.length++;this[e]=t,this._importants[e]=n},removeProperty:function(e){if(e in this){var t=Array.prototype.indexOf.call(this,e);if(t<0)return"";var n=this[e];return this[e]="",Array.prototype.splice.call(this,t,1),n}return""},getPropertyCSSValue:function(){},getPropertyPriority:function(e){return this._importants[e]||""},getPropertyShorthand:function(){},isPropertyImplicit:function(){},get cssText(){var e=[];for(var t=0,n=this.length;t<n;++t){var r=this[t],i=this.getPropertyValue(r),s=this.getPropertyPriority(r);s&&(s=" !"+s),e[t]=r+": "+i+s+";"}return e.join(" ")},set cssText(e){var t,n;for(t=this.length;t--;)n=this[t],this[n]="";Array.prototype.splice.call(this,0,this.length),this._importants={};var r=CSSOM.parse("#bogus{"+e+"}").cssRules[0].style,i=r.length;for(t=0;t<i;++t)n=r[t],this.setProperty(r[t],r.getPropertyValue(n),r.getPropertyPriority(n))}},CSSOM.CSSRule=function CSSRule(){this.parentRule=null,this.parentStyleSheet=null},CSSOM.CSSRule.STYLE_RULE=1,CSSOM.CSSRule.IMPORT_RULE=3,CSSOM.CSSRule.MEDIA_RULE=4,CSSOM.CSSRule.FONT_FACE_RULE=5,CSSOM.CSSRule.PAGE_RULE=6,CSSOM.CSSRule.WEBKIT_KEYFRAMES_RULE=8,CSSOM.CSSRule.WEBKIT_KEYFRAME_RULE=9,CSSOM.CSSRule.prototype={constructor:CSSOM.CSSRule},CSSOM.CSSStyleRule=function CSSStyleRule(){CSSOM.CSSRule.call(this),this.selectorText="",this.style=new CSSOM.CSSStyleDeclaration,this.style.parentRule=this},CSSOM.CSSStyleRule.prototype=new CSSOM.CSSRule,CSSOM.CSSStyleRule.prototype.constructor=CSSOM.CSSStyleRule,CSSOM.CSSStyleRule.prototype.type=1,CSSOM.CSSStyleRule.prototype.__defineGetter__("cssText",function(){var e;return this.selectorText?e=this.selectorText+" {"+this.style.cssText+"}":e="",e}),CSSOM.CSSStyleRule.prototype.__defineSetter__("cssText",function(e){var t=CSSOM.CSSStyleRule.parse(e);this.style=t.style,this.selectorText=t.selectorText}),CSSOM.CSSStyleRule.parse=function(e){var t=0,n="selector",r,i=t,s="",o={selector:!0,value:!0},u=new CSSOM.CSSStyleRule,a,f,l,c="";for(var h;h=e.charAt(t);t++)switch(h){case" ":case"	":case"\r":case"\n":case"\f":if(o[n])switch(e.charAt(t-1)){case" ":case"	":case"\r":case"\n":case"\f":break;default:s+=" "}break;case'"':i=t+1,r=e.indexOf('"',i)+1;if(!r)throw'" is missing';s+=e.slice(t,r),t=r-1;break;case"'":i=t+1,r=e.indexOf("'",i)+1;if(!r)throw"' is missing";s+=e.slice(t,r),t=r-1;break;case"/":if(e.charAt(t+1)==="*"){t+=2,r=e.indexOf("*/",t);if(r===-1)throw new SyntaxError("Missing */");t=r+1}else s+=h;break;case"{":n==="selector"&&(u.selectorText=s.trim(),s="",n="name");break;case":":n==="name"?(f=s.trim(),s="",n="value"):s+=h;break;case"!":n==="value"&&e.indexOf("!important",t)===t?(c="important",t+="important".length):s+=h;break;case";":n==="value"?(u.style.setProperty(f,s.trim(),c),c="",s="",n="name"):s+=h;break;case"}":if(n==="value")u.style.setProperty(f,s.trim(),c),c="",s="";else{if(n==="name")break;s+=h}n="selector";break;default:s+=h}return u},CSSOM.MediaList=function MediaList(){this.length=0},CSSOM.MediaList.prototype={constructor:CSSOM.MediaList,get mediaText(){return Array.prototype.join.call(this,", ")},set mediaText(e){var t=e.split(","),n=this.length=t.length;for(var r=0;r<n;r++)this[r]=t[r].trim()},appendMedium:function(e){Array.prototype.indexOf.call(this,e)===-1&&(this[this.length]=e,this.length++)},deleteMedium:function(e){var t=Array.prototype.indexOf.call(this,e);t!==-1&&Array.prototype.splice.call(this,t,1)}},CSSOM.CSSMediaRule=function CSSMediaRule(){CSSOM.CSSRule.call(this),this.media=new CSSOM.MediaList,this.cssRules=[]},CSSOM.CSSMediaRule.prototype=new CSSOM.CSSRule,CSSOM.CSSMediaRule.prototype.constructor=CSSOM.CSSMediaRule,CSSOM.CSSMediaRule.prototype.type=4,CSSOM.CSSMediaRule.prototype.__defineGetter__("cssText",function(){var e=[];for(var t=0,n=this.cssRules.length;t<n;t++)e.push(this.cssRules[t].cssText);return"@media "+this.media.mediaText+" {"+e.join("")+"}"}),CSSOM.CSSImportRule=function CSSImportRule(){CSSOM.CSSRule.call(this),this.href="",this.media=new CSSOM.MediaList,this.styleSheet=new CSSOM.CSSStyleSheet},CSSOM.CSSImportRule.prototype=new CSSOM.CSSRule,CSSOM.CSSImportRule.prototype.constructor=CSSOM.CSSImportRule,CSSOM.CSSImportRule.prototype.type=3,CSSOM.CSSImportRule.prototype.__defineGetter__("cssText",function(){var e=this.media.mediaText;return"@import url("+this.href+")"+(e?" "+e:"")+";"}),CSSOM.CSSImportRule.prototype.__defineSetter__("cssText",function(e){var t=0,n="",r="",i,s="";for(var o;o=e.charAt(t);t++)switch(o){case" ":case"	":case"\r":case"\n":case"\f":n==="after-import"?n="url":r+=o;break;case"@":!n&&e.indexOf("@import",t)===t&&(n="after-import",t+="import".length,r="");break;case"u":if(n==="url"&&e.indexOf("url(",t)===t){i=e.indexOf(")",t+1);if(i===-1)throw t+': ")" not found';t+="url(".length;var u=e.slice(t,i);u[0]===u[u.length-1]&&(u[0]==='"'||u[0]==="'")&&(u=u.slice(1,-1)),this.href=u,t=i,n="media"}break;case'"':if(n==="url"){i=e.indexOf('"',t+1);if(!i)throw t+": '\"' not found";this.href=e.slice(t+1,i),t=i,n="media"}break;case"'":if(n==="url"){i=e.indexOf("'",t+1);if(!i)throw t+': "\'" not found';this.href=e.slice(t+1,i),t=i,n="media"}break;case";":n==="media"&&r&&(this.media.mediaText=r.trim());break;default:n==="media"&&(r+=o)}}),CSSOM.CSSFontFaceRule=function CSSFontFaceRule(){CSSOM.CSSRule.call(this),this.style=new CSSOM.CSSStyleDeclaration,this.style.parentRule=this},CSSOM.CSSFontFaceRule.prototype=new CSSOM.CSSRule,CSSOM.CSSFontFaceRule.prototype.constructor=CSSOM.CSSFontFaceRule,CSSOM.CSSFontFaceRule.prototype.type=5,CSSOM.CSSFontFaceRule.prototype.__defineGetter__("cssText",function(){return"@font-face {"+this.style.cssText+"}"}),CSSOM.StyleSheet=function StyleSheet(){this.parentStyleSheet=null},CSSOM.CSSStyleSheet=function CSSStyleSheet(){CSSOM.StyleSheet.call(this),this.cssRules=[]},CSSOM.CSSStyleSheet.prototype=new CSSOM.StyleSheet,CSSOM.CSSStyleSheet.prototype.constructor=CSSOM.CSSStyleSheet,CSSOM.CSSStyleSheet.prototype.insertRule=function(e,t){if(t<0||t>this.cssRules.length)throw new RangeError("INDEX_SIZE_ERR");var n=CSSOM.parse(e).cssRules[0];return this.cssRules.splice(t,0,n),t},CSSOM.CSSStyleSheet.prototype.deleteRule=function(e){if(e<0||e>=this.cssRules.length)throw new RangeError("INDEX_SIZE_ERR");this.cssRules.splice(e,1)},CSSOM.CSSStyleSheet.prototype.toString=function(){var e="",t=this.cssRules;for(var n=0;n<t.length;n++)e+=t[n].cssText+"\n";return e},CSSOM.CSSKeyframesRule=function CSSKeyframesRule(){CSSOM.CSSRule.call(this),this.name="",this.cssRules=[]},CSSOM.CSSKeyframesRule.prototype=new CSSOM.CSSRule,CSSOM.CSSKeyframesRule.prototype.constructor=CSSOM.CSSKeyframesRule,CSSOM.CSSKeyframesRule.prototype.type=8,CSSOM.CSSKeyframesRule.prototype.__defineGetter__("cssText",function(){var e=[];for(var t=0,n=this.cssRules.length;t<n;t++)e.push("  "+this.cssRules[t].cssText);return"@"+(this._vendorPrefix||"")+"keyframes "+this.name+" { \n"+e.join("\n")+"\n}"}),CSSOM.CSSKeyframeRule=function CSSKeyframeRule(){CSSOM.CSSRule.call(this),this.keyText="",this.style=new CSSOM.CSSStyleDeclaration,this.style.parentRule=this},CSSOM.CSSKeyframeRule.prototype=new CSSOM.CSSRule,CSSOM.CSSKeyframeRule.prototype.constructor=CSSOM.CSSKeyframeRule,CSSOM.CSSKeyframeRule.prototype.type=9,CSSOM.CSSKeyframeRule.prototype.__defineGetter__("cssText",function(){return this.keyText+" {"+this.style.cssText+"} "}),CSSOM.parse=function parse(e){var t=0,n="before-selector",r,i="",s={selector:!0,value:!0,atRule:!0,"importRule-begin":!0,importRule:!0,atBlock:!0},o=new CSSOM.CSSStyleSheet,u=o,a,f,l,c,h="",p,d,v,m,g,y,b=/@(-(?:\w+-)+)?keyframes/g,w=function(n){var r=e.substring(0,t).split("\n"),i=r.length,s=r.pop().length+1,u=new Error(n+" (line "+i+", char "+s+")");throw u.line=i,u.char=s,u.styleSheet=o,u};for(var E;E=e.charAt(t);t++)switch(E){case" ":case"	":case"\r":case"\n":case"\f":s[n]&&(i+=E);break;case'"':r=t+1;do r=e.indexOf('"',r)+1,r||w('Unmatched "');while(e[r-2]==="\\");i+=e.slice(t,r),t=r-1;switch(n){case"before-value":n="value";break;case"importRule-begin":n="importRule"}break;case"'":r=t+1;do r=e.indexOf("'",r)+1,r||w("Unmatched '");while(e[r-2]==="\\");i+=e.slice(t,r),t=r-1;switch(n){case"before-value":n="value";break;case"importRule-begin":n="importRule"}break;case"/":e.charAt(t+1)==="*"?(t+=2,r=e.indexOf("*/",t),r===-1?w("Missing */"):t=r+1):i+=E,n==="importRule-begin"&&(i+=" ",n="importRule");break;case"@":if(e.indexOf("@media",t)===t){n="atBlock",d=new CSSOM.CSSMediaRule,d.__starts=t,t+="media".length,i="";break}if(e.indexOf("@import",t)===t){n="importRule-begin",t+="import".length,i+="@import";break}if(e.indexOf("@font-face",t)===t){n="fontFaceRule-begin",t+="font-face".length,m=new CSSOM.CSSFontFaceRule,m.__starts=t,i="";break}b.lastIndex=t;var S=b.exec(e);if(S&&S.index===t){n="keyframesRule-begin",g=new CSSOM.CSSKeyframesRule,g.__starts=t,g._vendorPrefix=S[1],t+=S[0].length-1,i="";break}n=="selector"&&(n="atRule"),i+=E;break;case"{":n==="selector"||n==="atRule"?(p.selectorText=i.trim(),p.style.__starts=t,i="",n="before-name"):n==="atBlock"?(d.media.mediaText=i.trim(),u=a=d,d.parentStyleSheet=o,i="",n="before-selector"):n==="fontFaceRule-begin"?(a&&(m.parentRule=a),m.parentStyleSheet=o,p=m,i="",n="before-name"):n==="keyframesRule-begin"?(g.name=i.trim(),a&&(g.parentRule=a),g.parentStyleSheet=o,u=a=g,i="",n="keyframeRule-begin"):n==="keyframeRule-begin"&&(p=new CSSOM.CSSKeyframeRule,p.keyText=i.trim(),p.__starts=t,i="",n="before-name");break;case":":n==="name"?(l=i.trim(),i="",n="before-value"):i+=E;break;case"(":n==="value"?(r=e.indexOf(")",t+1),r===-1&&w('Unmatched "("'),i+=e.slice(t,r+1),t=r):i+=E;break;case"!":n==="value"&&e.indexOf("!important",t)===t?(h="important",t+="important".length):i+=E;break;case";":switch(n){case"value":p.style.setProperty(l,i.trim(),h),h="",i="",n="before-name";break;case"atRule":i="",n="before-selector";break;case"importRule":v=new CSSOM.CSSImportRule,v.parentStyleSheet=v.styleSheet.parentStyleSheet=o,v.cssText=i+E,o.cssRules.push(v),i="",n="before-selector";break;default:i+=E}break;case"}":switch(n){case"value":p.style.setProperty(l,i.trim(),h),h="";case"before-name":case"name":p.__ends=t+1,a&&(p.parentRule=a),p.parentStyleSheet=o,u.cssRules.push(p),i="",u.constructor===CSSOM.CSSKeyframesRule?n="keyframeRule-begin":n="before-selector";break;case"keyframeRule-begin":case"before-selector":case"selector":a||w("Unexpected }"),u.__ends=t+1,o.cssRules.push(u),u=o,a=null,i="",n="before-selector"}break;default:switch(n){case"before-selector":n="selector",p=new CSSOM.CSSStyleRule,p.__starts=t;break;case"before-name":n="name";break;case"before-value":n="value";break;case"importRule-begin":n="importRule"}i+=E}return o},CSSOM.clone=function clone(e){var t=new CSSOM.CSSStyleSheet,n=e.cssRules;if(!n)return t;var r={1:CSSOM.CSSStyleRule,4:CSSOM.CSSMediaRule,8:CSSOM.CSSKeyframesRule,9:CSSOM.CSSKeyframeRule};for(var i=0,s=n.length;i<s;i++){var o=n[i],u=t.cssRules[i]=new r[o.type],a=o.style;if(a){var f=u.style=new CSSOM.CSSStyleDeclaration;for(var l=0,c=a.length;l<c;l++){var h=f[l]=a[l];f[h]=a[h],f._importants[h]=a.getPropertyPriority(h)}f.length=a.length}o.hasOwnProperty("keyText")&&(u.keyText=o.keyText),o.hasOwnProperty("selectorText")&&(u.selectorText=o.selectorText),o.hasOwnProperty("mediaText")&&(u.mediaText=o.mediaText),o.hasOwnProperty("cssRules")&&(u.cssRules=clone(o).cssRules)}return t};
